var Scroll=!1,Height=$(document).height(),title="",user,pw,status,username,mailfrom,mailto,msg,config,usrconfig="",configlang,xtitle=document.title,slider,slider2,dialogs=[],waitdialog,messid=0,appstate={first:!0,pushurl:""!=location.pathname?!1:!0},results={hits:0,hitspack:0,hitscurr:0,qtime:"",ppnlist:{}},searchvals={text:"",last:"","package":1,inittext:"",initfacets:{},search:""},facetvals={datapool:"",iln:"",yearrange:"",yearmin:"",yearmax:"",yearminstart:"",yearmaxstart:"",typ:"total",formats:{}},
statevals={ppnlist:[],language:"",layout:""},favors={},favormails={},favorprint={},idleTimer,time2warn=1080,time2kill=120,timer=!1,urlport=location.protocol+"//",linkresolver=!1,delay=function(){var a=0;return function(b,c){clearTimeout(a);a=setTimeout(b,c)}}();$.is_Empty=function(a){if(null==a)return!0;if(0<a.length)return!1;if(0===a.length||"object"!==typeof a)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0};
$.load_config=function(){$.post("/ajax/config",{screen:JSON.stringify({Width:screen.width,Height:screen.height}),platform:JSON.stringify(platform)},function(a){config=a;$.set_language(config.language,!0);tmp="";$.each(config.datapoolicons,function(a,c){tmp+="<li><a href='javascript:void(0)' data-icon='"+c+"' data-text='"+configlang[("datapool"+a).toUpperCase()]+"' data-value='"+a+"'><i class='"+c+" fa-fw'></i> "+configlang[("datapool"+a).toUpperCase()]+"</a></li>"});$(".facetpool").html(tmp);$(".facetpool li a").click(function(){var a=
$(this).data("value").toLowerCase();$(".icon_datapool").html("<i class='"+config.datapoolicons[a]+"'</i>");$(".lang_datapool").html(" "+configlang["DATAPOOL"+a.toUpperCase()]);$.set_facet("datapool","",a)});time2warn=60*config.time2warn;time2kill=60*config.time2kill;0==!usrconfig&&(timer=!0,$.startTimer());$.is_Empty(searchvals.initfacets)?facetvals.datapool=config.datapool:(facetvals=searchvals.initfacets,searchvals.initfacets={});$(".facetpool").parents(".dropdown").find(".btn").val(facetvals.datapool);
"local"==facetvals.datapool.toLowerCase()?($(".datapoollocal").removeClass("hide"),$(".datapoolglobal").addClass("hide")):($(".datapoollocal").addClass("hide"),$(".datapoolglobal").removeClass("hide"));""!=searchvals.inittext&&$.when($.new_search("initfacets",searchvals.inittext)).done(function(){searchvals.inittext=""})},"JSON")};
$.user_message=function(a,b,c){void 0==c&&(c=3E3);if(0<dialogs.length){var d=dialogs[dialogs.length-1].getData("name");"mail"==d&&(d="fullview_"+(dialogs.length-2).toString())}else d=0<results.hits?"results":"statusbar";var e="success"==b?"panel-success":"panel-danger";messid++;$("#"+d+"_messagebar").append($("<div id='message"+messid+"' class='alert-message "+b+"' data-alert></div>"));$("#message"+messid).hide().html("<div class='panel "+e+"'><div class='panel-heading'>"+a+"</div></div>").fadeIn("fast");
$("#message"+messid).delay(c).fadeOut("slow",function(){$(this).remove()})};$.focus_first=function(){768<=$(window).width()?$('[type="text"]:input:enabled:visible:first').focus():$("button:enabled:visible:first").focus()};
$.set_facet=function(a,b,c){"datapool"==a&&(facetvals={datapool:c,iln:"",yearrange:"",yearmin:"",yearmax:"",yearminstart:"",yearmaxstart:"",typ:"total",formats:{}},$.new_search("init",searchvals.text));"iln"==a&&(facetvals={datapool:"",iln:c,yearrange:"",yearmin:"",yearmax:"",yearminstart:"",yearmaxstart:"",typ:"total",formats:{}},$.new_search("init",searchvals.text));"year"==a&&($(".num_TYPTOTAL").html(""),$(".num_TYPPRINT").html(""),$(".num_TYPELECTR").html(""),$('input[name="facetonline"][value=total]').prop("checked",
!0),facetvals.typ="total",facetvals.formats={},$(".numformat").html(""),$("input.facetformat:checkbox").attr("checked",!1),$.new_search("facet_year"));"typ"==a&&(facetvals[a]=b,facetvals.formats={},$(".numformat").html(""),$("input.facetformat:checkbox").attr("checked",!1),$.new_search("facet_typ"));"format"==a&&(c?(facetvals.formats[b]=c,$.new_search("facet_format_checked")):(delete facetvals.formats[b],$.new_search("facet_format_unchecked")));$.post("/ajax/statsclient",{typ:"Facet",name:a,range:"day"})};
$.link_search=function(a,b){""!=b&&(""!=a&&(b="id"!=a&&"year"!=a?a+"('"+b+"')":a+"("+b.replace(/^\D+/g,"")+")"),$.close_dialogs(),$.new_search("link",b))};
$.push_state=function(){if(appstate.pushurl||appstate.first){var a={facetvals:facetvals,statevals:{language:config.language,layout:config.layout}},b=searchvals.text.replace(/"/g,"'").replace(/\*/g,"{star}").replace(/\//g,"{slash}").replace(/</g,"{st}").replace(/>/g,"{gt}").replace(/:/g,"{colon}"),b=urlport+window.location.host+"/"+encodeURIComponent(b),b=b+("/"+window.btoa(unescape(encodeURIComponent(JSON.stringify(a)))));appstate.first?(window.history.replaceState({text:searchvals.text,facets:facetvals,
states:statevals},searchvals.text.substring(0,20)+" | "+xtitle,b),appstate.first=!1):window.history.pushState({text:searchvals.text,facets:facetvals,states:statevals},searchvals.text.substring(0,20)+" | "+xtitle,b)}};$.navbar_search=function(a){a=$(a).val();$.new_search("init",a)};
$.new_search=function(a,b){if("facet_"!=a.substr(0,6).toLowerCase()){searchvals.last=searchvals.text;void 0==b||""==b?searchvals.text="*":(searchvals.text=b.trim().replace(/,/g,", ").replace(/  /g," "),b=b.trim().replace(/,/g,", ").replace(/  /g," "));if("cmd:"==searchvals.text.substr(0,4).toLowerCase()){$.command(searchvals.text.substr(4));$("#searchtext_xs").val(searchvals.last);$("#searchtext_md").val(searchvals.last);searchvals.text=searchvals.last;$.focus_first();return}$("#searchtext_xs").val(b);
$("#searchtext_md").val(b);"initfacets"!=a&&(facetvals.yearrange="",facetvals.yearmin="",facetvals.yearmax="",facetvals.yearminstart="",facetvals.yearmaxstart="",facetvals.typ="total",facetvals.formats={},$("#hiddenyearstart").val(""),$("#hiddenyearend").val(""))}Scroll=!1;searchvals["package"]=1;searchvals.search=searchvals.text;$.open_wait();return $.when($.search_results(a)).then(function(){0==results.hits&&$.user_message(configlang.NOHITS,"warning");$.close_wait();document.title=searchvals.text+
" | "+xtitle;$.push_state();appstate.pushurl=!0;$.focus_first()})};$.search_next_pack=function(a){Scroll=!1;$("#loading").removeClass("hideLoading").addClass("displayLoading");searchvals["package"]++;$.when($.search_results("adddata")).then(function(){$("#loading").removeClass("displayLoading").addClass("hideLoading");a()})};
$.search_results=function(a){return $.ajax({url:"/ajax/search/",method:"POST",data:{search:searchvals.search,"package":searchvals["package"],facets:JSON.stringify(facetvals)},dataType:"JSON",success:function(b){results.hits=b.hits;results.hitspack=b.hitspack;results.qtime=b.qtime;$(".TOTALRECS").html($.format_hits(results.hits));2<=searchvals["package"]?(results.ppnlist=results.ppnlist.concat(jQuery.map(b.ppnlist,function(a,b){return a.toString()})),results.hitscurr=results.ppnlist.length,$("#resultsonly").append(b.results).fadeIn("fast"),
50<=results.hitspack?$("#loading").fadeIn("fast").removeClass("collapse"):$("#loading").fadeOut("fast").addClass("collapse")):(window.scrollTo(0,0),results.ppnlist=jQuery.map(b.ppnlist,function(a,b){return a.toString()}),results.hitscurr=results.ppnlist.length,0==results.hitspack?"facet_"!=a.substr(0,6).toLowerCase()?($("#results").fadeOut("fast").addClass("collapse"),$("#loading").fadeOut("fast").addClass("collapse"),$("#start").fadeIn("fast").removeClass("collapse"),$("#btn_facets").addClass("hidden-xs"),
$("#statusbar").removeClass("collapse"),$("#version_start").fadeIn("fast").removeClass("collapse"),$("#version_search").fadeOut("fast").addClass("collapse")):$("#resultsonly").fadeOut("fast",function(){$("#statusbar").addClass("collapse");$("#resultsonly").html("");$("#loading").fadeOut("fast").addClass("collapse");$.number_facets(b,a);$("#resultsonly").fadeIn("fast").removeClass("collapse")}):($(".alert-message").remove(),$("#statusbar").addClass("collapse"),$("#start").fadeOut("fast").addClass("collapse"),
$("#version_start").fadeOut("fast").addClass("collapse"),$("#version_search").fadeIn("fast").removeClass("collapse"),"facet_"!=a.substr(0,6).toLowerCase()?$("#results").fadeOut("fast",function(){$("#resultsonly").html(b.results);$.create_facets(b);$("#facets").fadeIn("fast").removeClass("collapse");$("#results").fadeIn("fast").removeClass("collapse")}):$("#resultsonly").fadeOut("fast",function(){$("#resultsonly").html(b.results);$.number_facets(b,a);$("#resultsonly").fadeIn("fast").removeClass("collapse")}),
50<=results.hitspack?$("#loading").fadeIn("fast").removeClass("collapse"):$("#loading").fadeOut("fast").addClass("collapse"),$("#btn_facets").removeClass("hidden-xs")));Scroll=!1;50==results.hitspack&&(Scroll=!0)}})};
$.opened_fullview=function(a,b){linkresolver?(0<$("#linkresolvercontainer_"+b).length?$("#linkresolvercontainer_"+b).html("<div class='container-fluid'><div class='row'><div class='col-xs-12 col-sm-6 col-md-4'><div class='outercircle'></div><div class='innercircle'></div></div></div></div>"):$("#linkresolver_"+b).html("<div class='col-xs-12 col-sm-6 col-md-4'><div class='outercircle'></div><div class='innercircle'></div></div>"),$.when($.ajax({url:"/ajax/linkresolver/",method:"POST",data:{ppn:a},
dataType:"JSON"})).then(function(a){var d="";$.each(a,function(a,b){d+="<button onclick='$.openLink(\""+b+"\")' class='col-xs-12 col-sm-6 col-md-4 btn btn-default btn-exemplar'>"+configlang.FULLTEXT+" ("+configlang[a.toUpperCase()]+")</button>"});""!=d?0<$("#linkresolvercontainer_"+b).length?$("#linkresolvercontainer_"+b).html("<div>"+configlang.ACCESS+"</div><div class='container-fluid'><div class='row'>"+d+"</div></div>"):$("#linkresolver_"+b).html(d):($("#linkresolvercontainer_"+b).html(""),$("#linkresolver_"+
b).html(""))})):($("#linkresolvercontainer_"+b).html(""),$("#linkresolver_"+b).html(""));$.when($.ajax({url:"/ajax/searchsimularpubs/",method:"POST",data:{ppn:a},dataType:"JSON"})).then(function(c){0<c.hitspack?$("#simularpubscontent_"+b).html(c.results):$("#simularpubscontent_"+b).html("<div class='col-xs-12'><div class='well'>"+configlang.NOSIMULARHITS+"</div></div>");$.when($.ajax({url:"/ajax/exportlink/",method:"POST",data:{ppnlist:JSON.stringify(a),format:"zotero"},dataType:"JSON"})).then(function(a){$.each(a,
function(a,b){$(".Z3988").attr("title",b)})})})};$.searchrelatedarticles=function(a,b,c){$.when($.ajax({url:"/ajax/searchrelatedpubs/",method:"POST",data:{ppnlink:a,search:b},dataType:"JSON"})).then(function(a){0<a.hitspack?$("#relatedarticlescontent_"+c).html(a.results):$("#relatedarticlescontent_"+c).html("<div class='col-xs-12'><div class='well'>"+configlang.NOSIMULARHITS+"</div></div>")})};$.correctCover=function(a,b){a.onerror="";$(a).replaceWith("<span class='gbvicon'>"+b+"</span>")};
$.create_facets=function(a){facetvals.yearmin=parseInt(a.yearmin);facetvals.yearmax=parseInt(a.yearmax);if(facetvals.yearmin<facetvals.yearmax&&""!=facetvals.yearmin&&void 0!=facetvals.yearmin&&""!=facetvals.yearmax&&void 0!=facetvals.yearmax){var b={range:{min:facetvals.yearmin,max:facetvals.yearmax},start:[facetvals.yearmin,facetvals.yearmax],connect:!0,behaviour:"drag",step:1};facetvals.yearminstart=facetvals.yearmin;facetvals.yearmaxstart=facetvals.yearmax;"undefined"!=typeof slider&&slider.noUiSlider.destroy();
slider=document.getElementById("pubyear");noUiSlider.create(slider,b);slider.noUiSlider.on("update",function(a,b){$(".yearstart").html(Math.floor(a[0]));$(".yearend").html(Math.floor(a[1]));$(".yearstart2").html(Math.floor(a[0]));$(".yearend2").html(Math.floor(a[1]))});slider.noUiSlider.on("change",function(a,b){facetvals.yearminstart=Math.floor(a[0]);facetvals.yearmaxstart=Math.floor(a[1]);facetvals.yearrange!="["+facetvals.yearminstart+" TO "+facetvals.yearmaxstart+"]"&&(facetvals.yearrange="["+
facetvals.yearminstart+" TO "+facetvals.yearmaxstart+"]",$.set_facet("year","",facetvals.yearrange))});$(".FACETYEARTOTAL").fadeIn("fast").removeClass("collapse")}else $(".FACETYEARTOTAL").fadeOut("fast").addClass("collapse");$("#onlines").html("");b=parseInt(a.online["true"])+parseInt(a.online["false"]);$("#onlines").append("<div class='radio'><label><input class='facettyp' name='facetonline' class='TYPTOTAL'  value='total' type='radio' checked=checked><span class='lbl_TYPTOTAL'>"+configlang.TYPTOTAL+
"</span></label><span class='num_TYPTOTAL numtyp badge counter pull-right'>"+b+"</span></div>");$("#onlines").append("<div class='radio'><label><input class='facettyp' name='facetonline' class='TYPPRINT'  value='false' type='radio'><span class='lbl_TYPPRINT'>"+configlang.TYPPRINT+"</span></label><span class='num_TYPPRINT numtyp badge counter pull-right'>"+a.online["false"]+"</span></div>");$("#onlines").append("<div class='radio'><label><input class='facettyp' name='facetonline' class='TYPELECTR' value='true'  type='radio'><span class='lbl_TYPELECTR'>"+
configlang.TYPELECTR+"</span></label><span class='num_TYPELECTR numtyp badge counter pull-right'>"+a.online["true"]+"</span></div>");$(".facettyp").change(function(){$.set_facet("typ",$(this).val(),this.checked)});$(".datapool").change(function(){$.set_facet("datapool",$(this).val(),this.checked)});var c="";$.each(a.formats,function(a,b){c+="<div class='checkbox'><label><input class='facetformat' id='"+a.replace(/ /g,"")+"' value='"+a+"' type='checkbox'><span class='lbl_"+a.replace(/ /g,"")+"'>"+
configlang[a.replace(/ /g,"").toUpperCase()]+"</span></label><span class='num_"+a.replace(/ /g,"")+" numformat badge counter pull-right'>"+b+"</span></div>"});$("#formats").html(c);$(".facetformat").change(function(){$.set_facet("format",$(this).val(),this.checked)})};
$.number_facets=function(a,b){void 0!=a&&("facet_year"==b.toLowerCase()&&($(".num_TYPTOTAL").html(a.online.total),$(".num_TYPPRINT").html(a.online["false"]),$(".num_TYPELECTR").html(a.online["true"])),"facet_format_checked"!=b.toLowerCase()&&"facet_format_unchecked"!=b.toLowerCase()&&($(".numformat").html(""),0<Object.keys(a.formats).length&&$.each(a.formats,function(a,b){$(".num_"+a.replace(/ /g,"")).html(b)})))};
$.format_hits=function(a){return 1E6<a?String(Math.round(a/1E4)/100).replace(".",",")+" Mio. ":1E3<a?String(Math.round(a/10)/100).replace(".",",")+" Tsd. ":a};$.command=function(a){"library"==a.toLowerCase()?window.location.href=urlport+window.location.host+"/librarymodule":$.post("/ajax/command",{cmd:a},function(b){$.user_message("Befehl "+a+" erfolgreich ausgef&uuml;hrt","success");$.focus_first()},"json")};
$.open_fullview=function(a,b,c,d){void 0===b&&(b=results.ppnlist);void 0===d&&(d=a);void 0===c&&(c="main");"main"!=c&&(b=jQuery.map(b,function(a,b){return a.toString()}));var e=dialogs.length,f=a in favors?configlang.CHECKLISTREMOVE:configlang.CHECKLIST,g=a in favors?"fa fa-star-o":"fa fa-star",k="publications"==c?$("#related_"+d).html():$("#"+d+" div.panel-heading").html(),h=new BootstrapDialog({message:$('<div id="fullbody_'+e+'"><div class="outercircle"></div><div class="innercircle"></div>').load("/ajax/fullview/"+
a+"/"+e,function(){config.button_checklist&&h.getButton("checklist").prop("disabled",!1);config.button_export&&h.getButton("export").prop("disabled",!1);config.button_mail&&h.getButton("mail").prop("disabled",!1);config.button_print&&h.getButton("print").prop("disabled",!1);void 0!=$("#searchrelatedarticles")&&$("#searchrelatedarticles").keyup(function(){delay(function(){var b=$("#searchrelatedarticles").val().trim();$.searchrelatedarticles(a,b,e)},1E3)});$.opened_fullview(a,e)}),title:k,size:BootstrapDialog.SIZE_WIDE,
closable:!0,buttons:[{id:"prevbtn",icon:"glyphicon glyphicon-chevron-left",cssClass:"btn-default fullview-button-left",action:function(d){$(this).blur();0<b.indexOf(a)?(a=b[b.indexOf(a)-1],$("#fullbody_"+e).slideUp("fast","swing",function(){$("#fullbody_"+e).load("/ajax/fullview/"+a+"/"+e,function(){"publications"==c?d.getModalHeader().find(".bootstrap-dialog-title").html($("#related_"+a).html()):d.getModalHeader().find(".bootstrap-dialog-title").html($("#"+a+" div.panel-heading").html());$("#fullbody_"+
e).slideDown("fast");var b=d.getModalFooter().find(".checklist");a in favors?(b.find(".text").text(configlang.CHECKLISTREMOVE),b.find(".fa").removeClass("fa-star"),b.find(".fa").addClass("fa-star-o")):(b.find(".text").text(configlang.CHECKLIST),b.find(".fa").removeClass("fa-star-o"),b.find(".fa").addClass("fa-star"));$.opened_fullview(a,e)})})):$.user_message(configlang.FIRSTOBJECT,"warning")}},{id:"nextbtn",icon:"glyphicon glyphicon-chevron-right",cssClass:"btn-default fullview-button-left",action:function(d){$(this).blur();
"main"==c&&b.indexOf(a)<results.hits-1&&b.indexOf(a)==results.hitscurr-1?$.search_next_pack(function(){b=results.ppnlist;a=b[b.indexOf(a)+1];$("#fullbody_"+e).slideUp("fast","swing",function(){$("#fullbody_"+e).load("/ajax/fullview/"+a+"/"+e,function(){"publications"==c?d.getModalHeader().find(".bootstrap-dialog-title").html($("#related_"+a).html()):d.getModalHeader().find(".bootstrap-dialog-title").html($("#"+a+" div.panel-heading").html());$("#fullbody_"+e).slideDown("fast");var b=d.getModalFooter().find(".checklist");
a in favors?(b.find(".text").text(configlang.CHECKLISTREMOVE),b.find(".fa").removeClass("fa-star"),b.find(".fa").addClass("fa-star-o")):(b.find(".text").text(configlang.CHECKLIST),b.find(".fa").removeClass("fa-star-o"),b.find(".fa").addClass("fa-star"));$.opened_fullview(a,e)})})}):b.indexOf(a)<b.length-1?(a=b[b.indexOf(a)+1],$("#fullbody_"+e).slideUp("fast","swing",function(){$("#fullbody_"+e).load("/ajax/fullview/"+a+"/"+e,function(){"publications"==c?d.getModalHeader().find(".bootstrap-dialog-title").html($("#related_"+
a).html()):d.getModalHeader().find(".bootstrap-dialog-title").html($("#"+a+" div.panel-heading").html());$("#fullbody_"+e).slideDown("fast");var b=d.getModalFooter().find(".checklist");a in favors?(b.find(".text").text(configlang.CHECKLISTREMOVE),b.find(".fa").removeClass("fa-star"),b.find(".fa").addClass("fa-star-o")):(b.find(".text").text(configlang.CHECKLIST),b.find(".fa").removeClass("fa-star-o"),b.find(".fa").addClass("fa-star"));$.opened_fullview(a,e)})})):$.user_message(configlang.LASTOBJECT,
"warning")}},{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){a.close();$.focus_first()}},{id:"print",icon:"fa fa-print",label:" "+configlang.PRINT,action:function(a){$(this).blur();a=window.open();a.document.write("<html><head><title>"+configlang.PRINT+"</title></head><body>");a.document.write($("#mail_"+e).wrap("<p/>").parent().html());a.document.write("</body></html");a.document.close();a.focus();a.print();a.close()}},{id:"mail",icon:"glyphicon glyphicon-envelope",
label:" "+configlang.MAIL,action:function(b){$(this).blur();favormails[a]=$("#mail_"+e).wrap("<p/>").parent().html();""==usrconfig?$.login("LOGINFIRST",function(){""!=usrconfig&&$.open_mail([a])}):$.open_mail([a])}},{id:"export",icon:"glyphicon glyphicon-export",label:" "+configlang.EXPORT,action:function(b){$(this).blur();$.open_export([a])}},{id:"checklist",icon:g,cssClass:"btn-default checklist",label:' <span class="text">'+f+"</span>",action:function(b){$(this).blur();b=$(this);a in favors?(delete favors[a],
delete favormails[a],delete favorprint[a],$.user_message(configlang.CHECKLISTREMOVESUCCESS,"success"),b.find(".text").text(configlang.CHECKLIST),b.find(".fa").removeClass("fa-star-o"),b.find(".fa").addClass("fa-star")):(favors[a]=$("#"+a).clone().removeClass("medium col-xs-12 col-sm-6 col-md-4 col-lg-3","col-md-6").addClass("merk col-md-6"),$(favors[a]).find("a").attr("href","javascript:$.open_fullview('"+a+"',Object.keys(favors));"),favormails[a]=$("#mail_"+e).wrap("<p/>").parent().html(),favorprint[a]=
$("#mail_"+e).wrap("<p/>").parent().html(),$.user_message(configlang.CHECKLISTSUCCESS,"success"),b.find(".text").text(configlang.CHECKLISTREMOVE),b.find(".fa").removeClass("fa-star"),b.find(".fa").addClass("fa-star-o"));$.update_favors()}}],onhidden:function(){dialogs.pop();statevals.ppnlist.pop();$.push_state()},onshown:function(){dialogs.push(h);$.is_Empty(statevals)&&(statevals={});$.is_Empty(statevals.ppnlist)&&(statevals.ppnlist=[]);statevals.ppnlist.push({ppn:a,ppnlist:b,typ:c,parentppn:d});
$.push_state()}});h.realize();h.getModalHeader().addClass("preview-header");config.button_checklist?h.getButton("checklist").prop("disabled",!0):h.getButton("checklist").hide();config.button_export?h.getButton("export").prop("disabled",!0):h.getButton("export").hide();config.button_mail?h.getButton("mail").prop("disabled",!0):h.getButton("mail").hide();config.button_print?h.getButton("print").prop("disabled",!0):h.getButton("print").hide();h.setData("ppn",a);h.setData("name","fullview_"+e);h.open()};
$.open_assistant=function(){var a=dialogs.length,b=new BootstrapDialog({message:$('<div id="assistant_'+a+'"></div>').load("/ajax/assistant/"+a,function(){}),title:configlang.ASSISTANT,size:BootstrapDialog.SIZE_WIDE,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){a.close();$.focus_first()}},{icon:"fa fa-eraser",label:" "+configlang.CLEAR,action:function(b){$(this).blur();$("#title_"+a+" textarea").val("");$("#author_"+a+" textarea").val("");
$("#subject_"+a+" textarea").val("");$("#class_"+a+" textarea").val("");$("#contents_"+a+" textarea").val("");$("#year_"+a+" textarea").val("");$("#publisher_"+a+" textarea").val("");$("#isn_"+a+" textarea").val("");$("#series_"+a+" textarea").val("");$("#id_"+a+" textarea").val("");$.focus_first()}},{icon:"glyphicon glyphicon-search",label:" "+configlang.STARTSEARCH,cssClass:"fullview-button-color",action:function(b){$(this).blur();var d=b="",d=$.cleanArray($("#title_"+a+" textarea").val().split("\n"));
0<d.length&&(b+=' title("'+d.join('","')+'")');d=$.cleanArray($("#author_"+a+" textarea").val().split("\n"));0<d.length&&(b+=' author("'+d.join('","')+'")');d=$.cleanArray($("#subject_"+a+" textarea").val().split("\n"));0<d.length&&(b+=' subject("'+d.join('","')+'")');d=$.cleanArray($("#class_"+a+" textarea").val().split("\n"));0<d.length&&(b+=' class("'+d.join('","')+'")');d=$.cleanArray($("#contents_"+a+" textarea").val().split("\n"));0<d.length&&(b+=' contents("'+d.join('","')+'")');d=$.cleanArray($("#year_"+
a+" textarea").val().split("\n"));0<d.length&&(b+=' year("'+d.join('","')+'")');d=$.cleanArray($("#publisher_"+a+" textarea").val().split("\n"));0<d.length&&(b+=' publisher("'+d.join('","')+'")');d=$.cleanArray($("#isn_"+a+" textarea").val().split("\n"));0<d.length&&(b+=' isn("'+d.join('","')+'")');d=$.cleanArray($("#series_"+a+" textarea").val().split("\n"));0<d.length&&(b+=' series("'+d.join('","')+'")');d=$.cleanArray($("#id_"+a+" textarea").val().split("\n"));0<d.length&&(b+=' id("'+d.join('","')+
'")');$.when($.new_search("init",b)).then(function(){0==results.hits?$("#assistantcount").html("<h4>"+configlang.ASSISTANTNO+"</h4>"):$("#assistantcount").html("<h4>"+$.format_hits(results.hits)+" "+configlang.ASSISTANTYES+"</h4>")})}}],onhidden:function(){dialogs.pop()},onshown:function(){dialogs.push(b)}});b.realize();b.getModalHeader().addClass("preview-header");b.setData("name","assistant_"+a);b.open()};
$.update_favors=function(){$("#favors").html("");if(0<Object.keys(favors).length){var a=0;$.each(favors,function(b,c){a++;1==a%2&&$("#favors").append("<div class='row'>");$("#favors").append(c);0==a%2&&$("#favors").append("</div>")});1==a%2&&$("#favors").append("</div>")}else $("#favors").append("<div class='col-xs-12'>"+configlang.CHECKLISTEMPTY+"</div>")};
$.open_favors=function(){var a="",b="",c=new BootstrapDialog({message:'<div class="row" id="favors"></div><div id="favor_messagebar"></div>',title:"Merkliste "+config.softwarename,closable:!0,size:BootstrapDialog.SIZE_WIDE,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){a.close()}},{id:"print",icon:"fa fa-print",label:" "+configlang.PRINT,action:function(a){$(this).blur();if(0<Object.keys(favorprint).length){var b=window.open();b.document.write("<html><head><title>"+
configlang.PRINT+"</title></head><body>");$.each(favorprint,function(a,c){b.document.write(c);b.document.write("<hr>")});b.document.write("</body></html");b.document.close();b.focus();b.print();b.close()}}},{id:"mail",icon:"glyphicon glyphicon-envelope",label:" "+configlang.MAIL,action:function(a){$(this).blur();""==usrconfig?$.login("LOGINFIRST",function(){""!=usrconfig&&$.open_mail(Object.keys(favors))}):$.open_mail(Object.keys(favors))}},{id:"export",icon:"glyphicon glyphicon-export",label:" "+
configlang.EXPORT,action:function(a){$(this).blur();$.open_export(Object.keys(favors))}},{icon:"fa fa-eraser",label:" "+configlang.CHECKLISTCLEAR,action:function(c){$(this).blur();favors={};favorprint={};favormail={};a="success";b=configlang.CHECKLISTCLEARSUCCESS;c.close()}}],onhidden:function(){dialogs.pop();""!=a&&$.user_message(b,a);$.focus_first()},onshown:function(){dialogs.push(c);$.update_favors()}});c.realize();c.getModalHeader().addClass("preview-header");config.button_export||c.getButton("export").hide();
config.button_mail||c.getButton("mail").hide();config.button_print||c.getButton("print").hide();c.setData("name","favors");c.open()};
$.open_mail=function(a){if(""!=usrconfig){void 0!=usrconfig.email&&""!=usrconfig.email||$.user_message(configlang.PROVIDEMAIL,"warning");var b=usrconfig.email,c=(usrconfig.firstname+" "+usrconfig.lastname).trim(),d=new BootstrapDialog({message:'<div class="form-horizontal"><div class="form-group"><label for="mailto" class="col-sm-3 control-label">'+configlang.MAILRECIPIENT+'</label><div class="col-sm-9"><input type="mail" class="form-control" id="mailto" placeholder="'+configlang.MAILRECIPIENT+'"></div></div><div class="form-group"><label for="msg" class="col-sm-3 control-label">'+
configlang.YOURMESSAGE+'</label><div class="col-sm-9"><textarea class="form-control" rows="5" id="msg" placeholder="'+configlang.YOURMESSAGE+'"></textarea></div></div><div id="mail_messagebar"></div></div>',title:configlang.SENDMAIL,closable:!1,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){status=-1;a.close()}},{icon:"glyphicon glyphicon-log-in",label:" "+configlang.SENDMAIL,cssClass:"fullview-button-color",action:function(d){$(this).blur();username=$("#username").val();
mailfrom=$("#mailfrom").val();mailto=$("#mailto").val();msg=$("#msg").val();if(""==mailto)return $.user_message(configlang.REQUIREDFIELD,"warning"),$("#mailto").focus(),-1;if(!$.validateEmail(mailto))return $.user_message(configlang.MAILWRONG,"warning"),$("#mailto").focus(),-1;$.post("/ajax/mailto",{ppnlist:JSON.stringify(a),username:JSON.stringify(c),mailfrom:b,mailto:mailto,msg:JSON.stringify(msg),fullbody:JSON.stringify(favormails)},function(a){"0"<=a&&($.user_message(configlang.MAILSUCCESS,"success"),
d.close())})}}],onhidden:function(){dialogs.pop()},onshown:function(){dialogs.push(d);$("#username").focus()}});d.realize();d.getModalHeader().addClass("preview-header");d.setData("name","mail");d.open()}};
$.open_export=function(a){exportdialog=new BootstrapDialog({message:'<div class="form-horizontal"><div class="form-group"><label class="col-sm-2">Format</label><div class="col-sm-10"><div class="radio"><label><input type="radio" name="export" id="refworks" value="refworks" checked>refWorks</label></div><div class="radio"><label><input type="radio" name="export" id="citavi" value="citavi">Citavi</label></div><div class="radio"><label><input type="radio" name="export" id="endnote" value="endnote">Endnote</label></div><div class="radio"><label><input type="radio" name="export" id="bibtex" value="bibtex">BibTeX</label></div></div><div id="export_messagebar"></div></div></div>',title:configlang.EXPORT,
closable:!1,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){$(this).blur();status=-1;a.close()}},{icon:"glyphicon glyphicon-export",label:" "+configlang.EXPORT,cssClass:"fullview-button-color",action:function(b){$(this).blur();var c=$("input[name=export]:checked").val();"refworks"==c?$.post("/ajax/exportlink",{ppnlist:JSON.stringify(a),format:c},function(a){""!=a&&$.each(a,function(a,b){window.open(b,"_blank")})},"json"):$.each(a,function(a,b){window.open(urlport+
window.location.host+"/exportfile/"+b+"/"+c,"_blank")});b.close()}}],onhidden:function(){dialogs.pop()},onshown:function(){dialogs.push(exportdialog)}});exportdialog.realize();exportdialog.getModalHeader().addClass("preview-header");exportdialog.setData("name","export");exportdialog.open()};
$.open_wait=function(){waitdialog=new BootstrapDialog({message:'<div class="outercircle"></div><div class="innercircle"></div>',cssClass:"wait",animate:!1,closable:!1});waitdialog.realize();waitdialog.getModalHeader().hide();waitdialog.getModalFooter().hide();waitdialog.open()};$.close_wait=function(){waitdialog.close()};
$.login=function(a,b){var c="",d="",e="",f="",g=new BootstrapDialog({message:'<div class="form-horizontal"><div class="form-group"><label for="kennung" class="col-sm-3 control-label">'+configlang.USERNAME+'</label><div class="col-sm-9"><input type="text" class="form-control keyenter" id="kennung" placeholder="'+configlang.USERNAME+'"></div></div><div class="form-group"><label for="passwort" class="col-sm-3 control-label">'+configlang.PASSWORD+'</label><div class="col-sm-9"><input type="password" class="form-control keyenter" id="passwort" placeholder="'+
configlang.PASSWORD+'"></div></div><div id="login_messagebar"></div></div>',title:"Login "+config.softwarename,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){a.close();$.focus_first()}},{icon:"glyphicon glyphicon-log-in",label:" "+configlang.LOGIN,cssClass:"fullview-button-color",id:"loginbutton",action:function(a){$(this).blur();user=$("#kennung").val().trim();pw=$("#passwort").val().trim();if(""==user||""==pw)return $.user_message(configlang.REQUIREDTWOFIELDS,
"warning"),""==user?$("#kennung").focus():$("#passwort").focus(),-1;$.post("/ajax/login",{user:user,pw:pw},function(b){"-1"!=b?(a.close(),$(".nologinarea").addClass("hide"),$(".loginarea").removeClass("hide"),usrconfig=b,timer=!0,$.startTimer(),c="success",d=configlang.LOGINSUCCESS.replace("{firstname}",b.firstname).replace("{lastname}",b.lastname),b.collectable&&(e="warning",f=configlang.COLLECTABLEREMARK)):($.user_message(configlang.LOGINERROR,"warning"),$("#kennung").focus(),usrconfig="");$.focus_first()},
"json")}}],onhidden:function(){dialogs.pop();""!=c&&$.user_message(d,c);""!=e&&$.user_message(f,e,1E4);b()},onshown:function(){dialogs.push(g);"1"==config.devmode&&($("#kennung").val(config.devuser),$("#passwort").val(config.devpassword));$("#kennung").focus();$(".keyenter").keypress(function(a){13==a.which&&($(this).blur(),$("#loginbutton").focus().click())});void 0!=a&&""!=a&&$.user_message(configlang[a],"warning")}});g.realize();g.getModalHeader().addClass("preview-header");g.setData("name","login");
g.open()};$.loginonly=function(){$.login("",function(){})};
$.logout=function(){var a=new BootstrapDialog({message:"<div>"+configlang.LOGOUTREALLY.replace("{system}",config.softwarename)+'<div id="logout_messagebar"></div></div>',title:"Logout "+config.softwarename,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){a.close();$.focus_first()}},{icon:"glyphicon glyphicon-log-out",label:" "+configlang.LOGOUT,cssClass:"fullview-button-color",action:function(a){$.post("/ajax/logout",function(c){a.close();$(".nologinarea").removeClass("hide");
$(".loginarea").addClass("hide");$.reset_session()},"json")}}],onhidden:function(){dialogs.pop()},onshown:function(){dialogs.push(a)}});a.realize();a.getModalHeader().addClass("preview-header");a.setData("name","logout");a.open()};
$.open_facets=function(){var a=new BootstrapDialog({message:'<div><div id="FACETYEARTOTAL2"><div class="well"><div>'+configlang.FACETYEAR+' <span class="yearstart2 inlineedit"> </span> - <span class="yearend2 inlineedit"> </span></div><div id="pubyear2"> </div></div></div><div id="FACETTYPTOTAL2"><div class="well"><div class="FACETTYP">'+configlang.FACETTYP+'</div><div id="onlines2"></div></div></div><div id="FACETFORMATTOTAL2"><div class="well">'+configlang.FACETFORMAT+'<div id="formats2"></div></div><div id="facets_messagebar"></div></div>',
title:'<span class="TOTALRECS">'+results.hits+"</span> "+configlang.RESULTFILTER,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){a.close();$.focus_first()}}],onshown:function(b){dialogs.push(a);$(".yearstart2.inlineedit").inlineEdit($('<input name="temp_start" type="number" min="1000" max="9999" />'),$("#hiddenyearstart"));$(".yearend2.inlineedit").inlineEdit($('<input name="temp_end" type="number" min="1000" max="9999" />'),$("#hiddenyearend"));
facetvals.yearmin<facetvals.yearmax&&""!=facetvals.yearmin&&void 0!=facetvals.yearmin&&""!=facetvals.yearmax&&void 0!=facetvals.yearmax&&(b={range:{min:facetvals.yearmin,max:facetvals.yearmax},start:[facetvals.yearminstart,facetvals.yearmaxstart],connect:!0,behaviour:"drag",step:1},"undefined"!=typeof slider2&&slider2.noUiSlider.destroy(),slider2=document.getElementById("pubyear2"),noUiSlider.create(slider2,b),slider2.noUiSlider.on("update",function(a,b){$(".yearstart").html(Math.floor(a[0]));$(".yearend").html(Math.floor(a[1]));
$(".yearstart2").html(Math.floor(a[0]));$(".yearend2").html(Math.floor(a[1]))}),slider2.noUiSlider.on("change",function(a,b){facetvals.yearminstart=Math.floor(a[0]);facetvals.yearmaxstart=Math.floor(a[1]);facetvals.yearrange="["+facetvals.yearminstart+" TO "+facetvals.yearmaxstart+"]";$.set_facet("year","",facetvals.yearrange);slider.noUiSlider.set([facetvals.yearminstart,facetvals.yearmaxstart])}));$("#onlines").clone().attr("id","onlines2").replaceAll($("#onlines2"));$("#formats").clone().attr("id",
"formats2").replaceAll($("#formats2"));$(".facettyp").change(function(){$.set_facet("typ",$(this).val(),this.checked)});$(".facetformat").change(function(){$.set_facet("format",$(this).val(),this.checked)})},onhide:function(a){$("#onlines2").clone().attr("id","onlines").replaceAll($("#onlines"));$("#formats2").clone().attr("id","formats").replaceAll($("#formats"));$(".facettyp").change(function(){$.set_facet("typ",$(this).val(),this.checked)});$(".facetformat").change(function(){$.set_facet("format",
$(this).val(),this.checked)})},onhidden:function(){dialogs.pop()}});a.realize();a.getModalHeader().addClass("preview-header");a.setData("name","facets");a.open()};
$.open_user=function(a){a=$('<div id="userbody"></div>').load("/ajax/userview/"+a);if("ERROR:"==$.trim(a).substr(0,6).toUpperCase())$.user_message($.trim(a).slice(6),"warning");else{var b=new BootstrapDialog({message:a,title:configlang.AREA+" "+usrconfig.firstname+" "+usrconfig.lastname,size:BootstrapDialog.SIZE_WIDE,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){a.close();$.focus_first()}},{icon:"glyphicon glyphicon-triangle-bottom",label:" "+
configlang.OK,cssClass:"fullview-button-color",action:function(a){a.close();$.focus_first()}}],onhidden:function(){dialogs.pop()},onshown:function(){dialogs.push(b)}});b.realize();b.getModalHeader().addClass("preview-header");b.setData("name","user");b.open()}};
$.update_favs=function(){if("undefined"!==typeof Storage){var a=sessionStorage.favs?$.parseJSON(sessionStorage.favs):{};$(".fav").remove();$.each(a,function(a,c){$('<li><a id="'+a+'" class="fav" href="javascript:$.open_fullview(\''+a+"')\">"+c+"</a></li>").insertBefore(".favdivider1")});1<Object.keys(a).length?($(".favdivider1").removeClass("hide"),$(".compare").removeClass("hide")):($(".favdivider1").addClass("hide"),$(".compare").addClass("hide"));0<Object.keys(a).length?($(".nofavs").addClass("hide"),
$(".favdivider2").removeClass("hide"),$(".favstore").removeClass("hide"),$(".favdivider3").removeClass("hide"),$(".favclear").removeClass("hide")):($(".nofavs").removeClass("hide"),$(".favdivider2").addClass("hide"),$(".favstore").addClass("hide"),$(".favdivider3").addClass("hide"),$(".favclear").addClass("hide"))}};
$.set_layout=function(a){config.layout=a;$.post("/ajax/layout",{layout:a},function(a){$("#resultsonly").fadeOut("fast",function(){$("#resultsonly").html(a.results);window.scrollTo(0,0);$.focus_first();$("#resultsonly").fadeIn("fast").removeClass("collapse")})},"json");$.user_message(configlang.VIEWCHANGED.replace("{col}",12/a),"success")};
$.set_language=function(a,b){$.post("/ajax/language",{language:a},function(c){configlang=c;$(".search_text").attr("placeholder",configlang.YOURSEARCH);$(".lang_datapoollocal").html(configlang.DATAPOOLLOCAL);$(".lang_datapoolglobal").html(configlang.DATAPOOLGLOBAL);$(".ger").html(configlang.GER);$(".eng").html(configlang.ENG);$(".col1").html(configlang.COL1);$(".col2").html(configlang.COL2);$(".col3").html(configlang.COL3);$(".col4").html(configlang.COL4);$(".RESULTFILTER").html(configlang.RESULTFILTER);
$(".FACETYEAR").html(configlang.FACETYEAR);$(".FACETTYP").html(configlang.FACETTYP);$(".FACETFORMAT").html(configlang.FACETFORMAT);$(".lbl_TYPTOTAL").html(configlang.TYPTOTAL);$(".lbl_TYPPRINT").html(configlang.TYPPRINT);$(".lbl_TYPELECTR").html(configlang.TYPELECTR);$(".imprint").html(configlang.IMPRINT);$.each($(".facetformat"),function(){$(".lbl_"+this.id).html(configlang[this.id.replace(/ /g,"").toUpperCase()])});$(".myarea").attr("title",configlang.MYAREA);$(".myarea2").html('<i class="fa fa-user"></i> '+
configlang.MYAREA);$(".userrentals").html(configlang.USERRENTALS);$(".userorders").html(configlang.USERORDERS);$(".userreservations").html(configlang.USERRESERVATIONS);$(".userfees").html(configlang.USERFEES);$(".usersearches").html(configlang.USERSEARCHES);$(".userstore").html('<i class="glyphicon glyphicon-save"></i> '+configlang.USERSTORE);$(".favorites").attr("title",configlang.CHECKLIST);$(".selectview").attr("title",configlang.SELECTVIEW);$(".selectlanguage").attr("title",configlang.SELECTLANGUAGE);
$(".selectdatapool").attr("title",configlang.SELECTDATAPOOL);$(".startsearch").attr("title",configlang.STARTSEARCH);$(".filterresults").attr("title",configlang.RESULTFILTER);$(".selectdiscoverydatapool").length&&($(".selectdiscoverydatapool").find('[value=""]').html(configlang.DATAPOOLGLOBAL),$(".selectdiscoverydatapool").find('[value=""]').attr("data-tokens",configlang.ALL),$(".selectdiscoverydatapool").selectpicker("refresh"),$("[data-optgroup='1']").first().find(".text").html(configlang.ALL));
"ger"==a&&($("#welcome_eng").addClass("hide"),$("#welcome_ger").removeClass("hide"));"eng"==a&&($("#welcome_eng").removeClass("hide"),$("#welcome_ger").addClass("hide"));config.language=a;b||$.user_message(configlang.LANGUAGECHANGED,"success");$.focus_first()},"json")};
$.shelve=function(a,b,c){var d=b="",e;for(e in c)"action"!=e&&"typ"!=e&&"id"!=e&&""!=c[e]&&(""==d&&(d=e.replace(/\d/g,"")),""!=d&&d!=e.replace(/\d/g,"")&&(d=e.replace(/\d/g,""),b+="<br />"),b+=c[e].replace(/%lt%/g,"&lt;").replace(/%gt%/g,"&gt;")+"<br />");b+='<br /><div id="shelve_messagebar"></div>';c=$("#"+a+" div.panel-heading").html();void 0==c&&(c=$("#related_"+a).html());var f=new BootstrapDialog({message:b,title:c,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,
action:function(a){a.close();$.focus_first()}}],onhidden:function(){dialogs.pop()},onshown:function(){dialogs.push(f)}});f.realize();f.getModalHeader().addClass("preview-header");f.setData("name","shelve");f.open()};
$.reservation=function(a,b,c){var d=b="",e;for(e in c)"action"!=e&&"typ"!=e&&"id"!=e&&""!=c[e]&&(""==d&&(d=e.replace(/\d/g,"")),""!=d&&d!=e.replace(/\d/g,"")&&(d=e.replace(/\d/g,""),b+="<br />"),b+=c[e].replace(/%lt%/g,"&lt;").replace(/%gt%/g,"&gt;")+"<br />");b+='<br /><div id="reservation_messagebar"></div>';e=$("#"+a+" div.panel-heading").html();void 0==e&&(e=$("#related_"+a).html());var f="",g="",k=new BootstrapDialog({message:b,title:e,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",
label:" "+configlang.CANCEL,action:function(a){a.close();$.focus_first()}},{icon:"fa fa-map-marker",label:" "+configlang.RESERVATION,cssClass:"fullview-button-color",action:function(a){$(this).blur();""==usrconfig?$.login("LOGINFIRST",function(){$.post("/ajax/request",{uri:c.id},function(b){0>b.status?(f="warning",g=configlang.PROCESSSTOPPED+"<br />"+b.error):(f="success",g=configlang.RESERVATIONSUCCESS);a.close()},"json")}):$.post("/ajax/request",{uri:c.id},function(b){0>b.status?(f="warning",g=
configlang.PROCESSSTOPPED+"<br />"+b.error):(f="success",g=configlang.RESERVATIONSUCCESS);a.close()},"json")}}],onhidden:function(){dialogs.pop();""!=f&&$.user_message(g,f)},onshown:function(){dialogs.push(k)}});k.realize();k.getModalHeader().addClass("preview-header");k.setData("name","reservation");k.open()};
$.order=function(a,b,c){if(void 0!=c.id){var d=b="",e;for(e in c)"action"!=e&&"typ"!=e&&"id"!=e&&""!=c[e]&&(""==d&&(d=e.replace(/\d/g,"")),""!=d&&d!=e.replace(/\d/g,"")&&(d=e.replace(/\d/g,""),b+="<br />"),b+=c[e].replace(/%lt%/g,"&lt;").replace(/%gt%/g,"&gt;")+"<br />");b+='<br /><div id="order_messagebar"></div>';e=$("#"+a+" div.panel-heading").html();void 0==e&&(e=$("#related_"+a).html());var f="",g="",k=new BootstrapDialog({message:b,title:e,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",
label:" "+configlang.CANCEL,action:function(a){a.close();$.focus_first()}},{icon:"fa fa-map-marker",label:" "+configlang.ORDER,cssClass:"fullview-button-color",action:function(a){$(this).blur();""==usrconfig?$.login("LOGINFIRST",function(){$.post("/ajax/request",{uri:c.id},function(b){0>b.status?(f="warning",g=configlang.PROCESSSTOPPED+"<br />"+b.error):(f="success",g=configlang.ORDERSUCCESS);a.close()},"json")}):$.post("/ajax/request",{uri:c.id},function(b){0>b.status?(f="warning",g=configlang.PROCESSSTOPPED+
"<br />"+b.error):(f="success",g=configlang.ORDERSUCCESS);a.close()},"json")}}],onhidden:function(){dialogs.pop();""!=f&&$.user_message(g,f)},onshown:function(){dialogs.push(k)}});k.realize();k.getModalHeader().addClass("preview-header");k.setData("name","order");k.open()}};
$.mailorder=function(a,b,c){var d="",e="",f=$("#"+a+" div.panel-heading").html();void 0==f&&(f=$("#related_"+a).html());var g="ORDER",k="MAILORDER",h="Magazinbestellung",l=new BootstrapDialog({message:$('<div id="mailorderviewbody"></div>').load("/ajax/mailorderview/"+a+"/"+b,function(){}),title:f,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(a){a.close();$.focus_first()}},{id:"mailbtn",icon:"fa fa-map-marker",label:" "+configlang.MAILORDER,cssClass:"fullview-button-color",
action:function(b){$(this).blur();var f=$("input[name=mailto]:checked").val();void 0==f&&(f=$("#mailto").attr("value"));if(void 0==f)return $.user_message("Die MailTo-Adresse konnte nicht ermittelt werden!","warning"),-1;var g=$("input[name=mailfrom]:checked").val();void 0==g&&(g=$("#mailfrom").attr("value"));if(void 0==g)return $.user_message("Die MailFrom-Adresse konnte nicht ermittelt werden!","warning"),-1;if(""==usrconfig)$.login("LOGINFIRST",function(){var l={},m=$("input[name=volume]").val();
void 0!=m&&(l.volume=m);m=$("#mail_"+(dialogs.length-2)).wrap("<p/>").parent().html();$.post("/ajax/mailorderto",{exemplar:JSON.stringify(c),fullbody:JSON.stringify(m),ppn:a,mailto:f,mailfrom:g,userinput:JSON.stringify(l),mailtyp:k,mailsubject:h},function(a){0>a.status?$.user_message(configlang.PROCESSSTOPPED+"<br />"+a.error,"warning"):(d="success",e=configlang.ORDERSUCCESS,b.close())},"json")});else{var l={},m=$("input[name=volume]").val();void 0!=m&&(l.volume=m);m=$("#mail_"+(dialogs.length-2)).wrap("<p/>").parent().html();
$.post("/ajax/mailorderto",{exemplar:JSON.stringify(c),fullbody:JSON.stringify(m),ppn:a,mailto:f,mailfrom:g,userinput:JSON.stringify(l),mailtyp:k,mailsubject:h},function(a){0>a.status?$.user_message(configlang.PROCESSSTOPPED+"<br />"+a.error,"warning"):(d="success",e=configlang.ORDERSUCCESS,b.close())},"json")}}}],onhidden:function(){dialogs.pop();""!=d&&$.user_message(e,d)},onshown:function(){dialogs.push(l);g=$("#mailbutton").attr("value").toString();k=$("#mailtyp").attr("value").toString();h=$("#mailsubject").attr("value").toString();
l.getButton("mailbtn").html("<span class='bootstrap-dialog-button-icon fa fa-map-marker'></span> "+g)}});l.realize();l.getModalHeader().addClass("preview-header");l.setData("name","mailorder");l.open()};$.cancel=function(a){$.post("/ajax/cancel",{uri:a},function(a){0>a.status?$.user_message(configlang.PROCESSSTOPPED+"<br />"+a.error,"warning"):$.user_message(configlang.CANCELSUCCESS,"success")},"json")};
$.renew=function(a){$.post("/ajax/renew",{uri:a},function(a){$.close_dialogs();$.open_user("userrentals");0>a.status?$.user_message(configlang.PROCESSSTOPPED+"<br />"+a.error,"warning"):$.user_message(configlang.RENEWSUCCESS,"success")},"json")};$.close_dialogs=function(){for(var a=dialogs.length-1;0<=a;a--)dialogs[a].close()};
$.reset_session=function(){$.close_dialogs();$.post("/ajax/sessclear",function(a){$("#searchtext_xs").val("");$("#searchtext_md").val("");$(".nologinarea").removeClass("hide");$(".loginarea").addClass("hide");$("#facets").fadeOut("fast").addClass("collapse");$("#results").addClass("collapse");$("#resultsonly").html("");$("#loading").fadeOut("fast").addClass("collapse");$("#start").fadeIn("fast").removeClass("collapse");$(".fav").remove();$(".favdivider1").addClass("hide");$(".compare").addClass("hide");
$(".nofavs").removeClass("hide");$(".favdivider2").addClass("hide");$(".favstore").addClass("hide");$(".favdivider3").addClass("hide");$(".favclear").addClass("hide");window.history.replaceState("","",urlport+window.location.host);view="3";results.hits=0;Scroll=!1;usrconfig="";config.layout=3;messid=0;results={hits:0,hitspack:0,hitscurr:0,qtime:"",ppnlist:{}};searchvals={text:"",last:"","package":1,inittext:"",initfacets:{}};facetvals={datapool:"",iln:"",yearrange:"",yearmin:"",yearmax:"",yearminstart:"",
yearmaxstart:"",typ:"total",formats:{}};favors={};$.load_config();timer=!1;$(document.body).unbind();window.location.href=urlport+window.location.host})};
$.store_search=function(){window.scrollTo(0,0);""==usrconfig?$.user_message(unescape("Achtung<br />Bitte dazu zun%E4chst am System angemelden!"),"warning"):$.post("/ajax/storeusersearch",{search:searchvals.text,user:usrconfig.username,facets:window.btoa(unescape(encodeURIComponent(JSON.stringify(facetvals))))},function(a){0>a.status?$.user_message(configlang.PROCESSSTOPPED+"<br />"+a.error,"warning"):$.user_message("Erfolg","success")},"json")};
$.facet_search=function(a,b){$.close_dialogs();searchvals.initfacets=b;0<Object.keys(searchvals.initfacets).length?(facetvals=searchvals.initfacets,searchvals.initfacets={}):facetvals.datapool=config.datapool;$(".facetpool").parents(".dropdown").find(".btn").val(facetvals.datapool);$(".datapool").html(configlang["DATAPOOL"+facetvals.datapool.toUpperCase()]);$.new_search("initfacets",decodeURIComponent(escape(atob(a))))};
$.pop_search=function(a,b){$.close_dialogs();searchvals.initfacets=b;0<Object.keys(searchvals.initfacets).length?(facetvals=searchvals.initfacets,searchvals.initfacets={}):facetvals.datapool=config.datapool;$(".facetpool").parents(".dropdown").find(".btn").val(facetvals.datapool);$(".datapool").html(configlang["DATAPOOL"+facetvals.datapool.toUpperCase()]);appstate.pushurl=!1;return $.new_search("initfacets",a)};
$.startTimer=function(){$(document.body).bind("mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick",$.resetTimer);$.resetTimer()};$.resetTimer=function(){clearTimeout(idleTimer);idleTimer=setTimeout($.whenUserAlmostIdle,1E3*time2warn)};
$.whenUserAlmostIdle=function(){clearTimeout(idleTimer);idleTimer=setTimeout($.whenUserIdle,1E3*time2kill);var a=new BootstrapDialog({message:unescape('Sie werden in <span class="customer-link" id="countdown">'+(time2kill-1)+"</span> Sekunden automatisch abgemeldet"),title:"Automatische Abmeldung",closable:!1,type:BootstrapDialog.TYPE_DANGER,onhidden:function(){dialogs.pop()},onshown:function(){dialogs.push(a);$.startCountdown(time2kill-2,$("#countdown"));$(document.body).unbind();$(document.body).bind("mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick",
$.whenUserStopsAlmostIdle)}});a.realize();a.getModalHeader().addClass("preview-header");a.setData("name","almostidledialog");a.open()};$.whenUserStopsAlmostIdle=function(){dialogs[dialogs.length-1].close();$(document.body).unbind();$(document.body).bind("mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick",$.resetTimer);$.resetTimer()};
$.whenUserIdle=function(){$.user_message(configlang.IDLEHAPPENED,"warning");$.post("/ajax/logout",function(a){$(".nologinarea").removeClass("hide");$(".loginarea").addClass("hide")},"json");$.reset_session()};$.startCountdown=function(a,b){var c=a;setInterval(function(){b.html(c);0>--c&&(c=a)},1E3)};
$.fn.inlineEdit=function(a,b){$.detectIE()||$(this).click(function(){var c=$(this);c.hide();c.after(a);a.focus();"temp_start"==a.attr("name")&&(""!=facetvals.yearminstart?a.val(facetvals.yearminstart):a.val(facetvals.yearmin));"temp_end"==a.attr("name")&&(""!=facetvals.yearmaxstart?a.val(facetvals.yearmaxstart):a.val(facetvals.yearmax));a.keypress(function(a){13!=a.keypress&&13!=a.keyCode||$.focus_first()});a.blur(function(){""!=$(this).val()&&($(this).val()<facetvals.yearmin||$(this).val()>facetvals.yearmax||
"temp_start"==$(this).attr("name")&&$(this).val()>facetvals.yearmaxstart||"temp_end"==$(this).attr("name")&&$(this).val()<facetvals.yearminstart?(window.scrollTo(0,0),$.user_message(configlang.CORRECTPERIOD.replace("{PERIOD}",facetvals.yearmin+"-"+facetvals.yearmax)),$(this).val("")):(b.val($(this).val()).change(),c.text($(this).val())));$(this).remove();c.show()})})};
$.detectIE=function(a){a=window.navigator.userAgent;var b=a.indexOf("MSIE ");if(0<b)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);if(0<a.indexOf("Trident/"))return b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10);b=a.indexOf("Edge/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):!1};$.validateEmail=function(a){return/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test(a)};
$.cleanArray=function(a){for(var b=0;b<a.length;b++)void 0==a[b].trim()||""==a[b].trim()?(a.splice(b,1),b--):a[b]=a[b].trim();return a};$.openLink=function(a){$.post("/ajax/statsclient",{typ:"Link",name:a,range:"year"});window.open(a,"_blank")};
$(function(){$.load_config();$.update_favs();$(".lang li a").click(function(){"ger"==$(this).data("value")?($(".lang_ger").removeClass("hide"),$(".lang_eng").addClass("hide")):($(".lang_ger").addClass("hide"),$(".lang_eng").removeClass("hide"));$.set_language($(this).data("value"),!1)});$(".layout li a").click(function(){$.set_layout($(this).data("value"))});$(window).scroll(function(){Scroll&&$(window).scrollTop()+500>=$(document).height()-$(window).height()&&$.search_next_pack(function(){})});window.scrollTo(0,
0);$(".typeahead").typeahead({ajax:"/ajax/getwords",onSelect:function(a){$.new_search("init",a.value)}});window.onpopstate=function(a){$.close_dialogs();$("#facets").fadeOut("fast").addClass("collapse");$("#results").addClass("collapse");$("#resultsonly").html("");$("#loading").fadeOut("fast").addClass("collapse");null!=a.state&&0<Object.keys(a.state).length?$.when($.pop_search(a.state.text,a.state.facets)).done(function(){document.title=a.state.text+" | "+xtitle}):($("#start").fadeIn("fast").removeClass("collapse"),
$("#searchtext_xs").val(""),$("#searchtext_md").val(""))};$(".yearstart.inlineedit").inlineEdit($('<input name="temp_start" type="number" min="1000" max="9999" />'),$("#hiddenyearstart"));$(".yearend.inlineedit").inlineEdit($('<input name="temp_end" type="number" min="1000" max="9999" />'),$("#hiddenyearend"));$("#hiddenyearstart").change(function(){facetvals.yearminstart=$("#hiddenyearstart").val();facetvals.yearrange="["+facetvals.yearminstart+" TO "+facetvals.yearmaxstart+"]";$.set_facet("year");
slider.noUiSlider.set([facetvals.yearminstart,facetvals.yearmaxstart]);void 0!=slider2&&slider2.noUiSlider.set([facetvals.yearminstart,facetvals.yearmaxstart])});$("#hiddenyearend").change(function(){facetvals.yearmaxstart=$("#hiddenyearend").val();facetvals.yearrange="["+facetvals.yearminstart+" TO "+facetvals.yearmaxstart+"]";$.set_facet("year");slider.noUiSlider.set([facetvals.yearminstart,facetvals.yearmaxstart]);void 0!=slider2&&slider2.noUiSlider.set([facetvals.yearminstart,facetvals.yearmaxstart])});
$.focus_first()});
