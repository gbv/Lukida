var urlport=location.protocol+"//",configlang={},config={},messid=0,params={areas:[],start:moment().subtract(8,"days").format("YYYY-MM-DD"),end:moment().subtract(1,"days").format("YYYY-MM-DD"),year:moment().format("YYYY")},mainarea="",chart="searches",bstacked=!1,access=!1;$.go=function(b){"discover"==b&&(window.location.href=urlport+window.location.host)};
$.toggle_area=function(b){$("#"+b+"up").toggleClass("collapse");$("#"+b+"down").toggleClass("collapse");$("#library"+b).is(":hidden")?$("#library"+b).slideDown("slow"):$("#library"+b).slideUp("slow")};$.set_params=function(){params.areas="";$(".well").find(":checkbox").each(function(){"Stapel"==$(this).attr("name")?bstacked=this.checked?!0:!1:params.areas=""==params.areas?params.areas+(this.checked?$(this).data("value"):""):params.areas+(this.checked?","+$(this).data("value"):"")})};
$.open_password=function(){var b=new BootstrapDialog({message:'<div class="form-horizontal"><div class="form-group"><label for="pwpasswort" class="col-sm-3 control-label">'+configlang.PASSWORD+'</label><div class="col-sm-9"><input type="password" class="form-control keyenter" id="pwpasswort" placeholder="'+configlang.PASSWORD+'"></div></div><div id="pw_messagebar"></div></div>',title:configlang.MODULEACCESS,closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(c){c.close()}},
{icon:"glyphicon glyphicon-log-in",label:" "+configlang.LOGIN,cssClass:"fullview-button-color",id:"pwbutton",action:function(c){$(this).blur();pw=$("#pwpasswort").val().trim();if(""==pw)return $.user_message(configlang.PASSWORDWRONG,"warning","pw"),$("#pwpasswort").focus(),-1;$.post("/ajax/checkpw",{module:"library",pw},function(a){"1"==a.status?(access=!0,c.close(),$.set_cockpit()):($.user_message(configlang.LOGINERROR,"warning","pw"),$("#kennung").focus())},"json")}}],onshown:function(){$(".keyenter").keypress(function(c){13==
c.which&&($(this).blur(),$("#pwbutton").focus().click())});$("#pwpasswort").focus()}});b.realize();b.getModalHeader().addClass("preview-header");b.setData("name","pw");b.open()};
$.set_language=function(b,c){$.post("/ajax/language",{language:b},function(a){configlang=a;$(".ger").html(configlang.GER);$(".eng").html(configlang.ENG);$(".selectlanguage").attr("title",configlang.SELECTLANGUAGE);config.language=b;"ger"==b?($(".lang_ger").removeClass("hide"),$(".lang_eng").addClass("hide")):($(".lang_ger").addClass("hide"),$(".lang_eng").removeClass("hide"));$.refresh();c||$.user_message(configlang.LANGUAGECHANGED,"success")},"json")};
$.user_message=function(b,c,a="statusbar",d){void 0==d&&(d=3E3);var e="success"==c?"panel-success":"panel-danger";messid++;$("#"+a+"_messagebar").append($("<div id='message"+messid+"' class='alert-message "+c+"' data-alert></div>"));$("#message"+messid).hide().html("<div class='panel "+e+"'><div class='panel-heading'>"+b+"</div></div>").fadeIn("fast");$("#message"+messid).delay(d).fadeOut("slow",function(){$(this).remove()})};
$.refresh=function(){$("#container_cockpit").hasClass("collapse")||$.set_cockpit();$("#container_chart").hasClass("collapse")||$.set_chart(chart);$("#container_log").hasClass("collapse")||$.set_log()};
$.set_cockpit=function(){if(access){void 0!==window.myChart&&window.myChart.destroy();"cockpit"!=mainarea&&(mainarea="cockpit",$("#container_chart").addClass("collapse"),$("#container_log").addClass("collapse"),$("#container_cockpit").removeClass("collapse"),$("#libraryoption").is(":visible")?$("#libraryoption").slideUp("slow",function(){$("#optionup").toggleClass("collapse");$("#optiondown").toggleClass("collapse");$("#libraryoption").find(".option").hide();$("#libraryoption").find(".cockpit").show()}):
($("#libraryoption").find(".option").hide(),$("#libraryoption").find(".cockpit").show()),$("#libraryhelp").is(":visible")?$("#libraryhelp").slideUp("slow",function(){$("#helpup").toggleClass("collapse");$("#helpdown").toggleClass("collapse");$("#help_chart").addClass("collapse");$("#help_log").addClass("collapse");$("#help_cockpit").removeClass("collapse")}):($("#help_chart").addClass("collapse"),$("#help_log").addClass("collapse"),$("#help_cockpit").removeClass("collapse")));var b=$.ajax({url:"/ajax/cockpit",
method:"POST",dataType:"JSON",data:{params:JSON.stringify(params)}});b.done(function(c){var a="";$.each(c.data,function(){a+="<div class='row'>";area=this.label;icon=this.icon;count=0;$.each(this.values,function(d,e){count++;a+="<div class='col-md-4'>";a+="<div class='widget ";1==count%3&&(a+="navy");2==count%3&&(a+="lazur");0==count%3&&(a+="orange");a+="'>";a+="<div class='row'>";a+="<div class='col-xs-4'>";a+="<i class='"+icon+"'></i>";a+="</div>";a+="<div class='col-xs-8 text-right'>";a+="<span> "+
area+" "+d+"</span>";a+="<h2 class='font-bold'>"+e+"</h2>";a+="</div>";a+="</div>";a+="</div>";a+="</div>"});a+="</div>"});$("#results_cockpit").html(a)});b.fail(function(c,a){console.log("Request failed: "+a)})}else $.open_password()};
$.set_chart=function(b){if(access){if("chart"!=mainarea||chart!=b)mainarea="chart",chart=b,$("#container_cockpit").addClass("collapse"),$("#container_log").addClass("collapse"),$("#container_chart").removeClass("collapse"),$("#libraryoption").is(":visible")?$("#libraryoption").slideUp("slow",function(){$("#optionup").toggleClass("collapse");$("#optiondown").toggleClass("collapse");$("#libraryoption").find(".option").hide();$("#libraryoption").find("."+b).show()}):($("#libraryoption").find(".option").hide(),
$("#libraryoption").find("."+b).show()),$("#libraryhelp").is(":visible")?$("#libraryhelp").slideUp("slow",function(){$("#helpup").toggleClass("collapse");$("#helpdown").toggleClass("collapse");$("#help_cockpit").addClass("collapse");$("#help_log").addClass("collapse");$("#help_chart").removeClass("collapse");$("#help_chart").find(".well").hide();$("#help_chart").find("."+b).show()}):($("#help_cockpit").addClass("collapse"),$("#help_log").addClass("collapse"),$("#help_chart").removeClass("collapse"),
$("#help_chart").find(".well").hide(),$("#help_chart").find("."+b).show());"searches"==b&&$.ajax({url:"/ajax/chart",method:"POST",dataType:"JSON",data:{typ:"searches",params:JSON.stringify(params)},success:function(c){void 0!==window.myChart&&window.myChart.destroy();var a=$("#chart");window.myChart=new Chart(a,{type:"bar",data:c.data,options:{title:c.title,scales:{xAxes:[{ticks:{fontColor:"#000"}}],yAxes:[{ticks:{beginAtZero:!0,fontColor:"#000"}}],gridLines:{Color:"rgba(0, 0, 0, 1)",lineWidth:2}}}})}});
"usage"==b&&$.ajax({url:"/ajax/chart",method:"POST",dataType:"JSON",data:{typ:"usage",params:JSON.stringify(params)},success:function(c){void 0!==window.myChart&&window.myChart.destroy();var a=$("#chart");window.myChart=new Chart(a,{type:"line",data:c.data,options:{title:c.title,scales:{xAxes:[{ticks:{fontColor:"#000"}}],yAxes:[{ticks:{beginAtZero:!0,fontColor:"#000"},stacked:bstacked}],gridLines:{Color:"rgba(0, 0, 0, 1)",lineWidth:2}}}})}});"usageyear"==b&&$.ajax({url:"/ajax/chart",method:"POST",
dataType:"JSON",data:{typ:"usageyear",params:JSON.stringify(params)},success:function(c){void 0!==window.myChart&&window.myChart.destroy();var a=$("#chart");window.myChart=new Chart(a,{type:"bar",data:c.data,options:{title:c.title,scales:{xAxes:[{ticks:{fontColor:"#000"}}],yAxes:[{ticks:{beginAtZero:!0,fontColor:"#000"},stacked:bstacked}],gridLines:{Color:"rgba(0, 0, 0, 1)",lineWidth:2}}}})}});"devicescreens"==b&&$.ajax({url:"/ajax/chart",method:"POST",dataType:"JSON",data:{typ:"devicescreens",params:JSON.stringify(params)},
success:function(c){void 0!==window.myChart&&window.myChart.destroy();var a=$("#chart");window.myChart=new Chart(a,{type:"bubble",data:c.data,options:{title:c.title,legend:{display:!1}}})}})}else $.open_password()};
$.set_log=function(){if(access){void 0!==window.myChart&&window.myChart.destroy();"log"!=mainarea&&(mainarea="log",$("#container_cockpit").addClass("collapse"),$("#container_chart").addClass("collapse"),$("#container_log").removeClass("collapse"),$("#libraryoption").is(":visible")?$("#libraryoption").slideUp("slow",function(){$("#optionup").toggleClass("collapse");$("#optiondown").toggleClass("collapse");$("#libraryoption").find(".option").hide();$("#libraryoption").find(".log").show()}):($("#libraryoption").find(".option").hide(),
$("#libraryoption").find(".log").show()),$("#libraryhelp").is(":visible")?$("#libraryhelp").slideUp("slow",function(){$("#helpup").toggleClass("collapse");$("#helpdown").toggleClass("collapse");$("#help_cockpit").addClass("collapse");$("#help_chart").addClass("collapse");$("#help_log").removeClass("collapse")}):($("#help_cockpit").addClass("collapse"),$("#help_chart").addClass("collapse"),$("#help_log").removeClass("collapse")));$("#searchlog").keyup(function(){$("tr.entry").removeClass("collapse");
$("tr.entry:not(:contains("+$("#searchlogtext").val().toLowerCase()+"))").addClass("collapse")});var b=$.ajax({url:"/ajax/log",method:"POST",dataType:"JSON",data:{params:JSON.stringify(params)}});b.done(function(c){var a="";a+="<div class='table-responsive'>";a+="<table class='table table-striped'>";a+="<thead><tr>";$.each(c.data[0],function(d,e){"id"!=d&&"Details"!=d&&(a+="<th>"+d+"</th>")});a+="</tr></thead>";a+="<tbody>";$.each(c.data,function(d){a+="<tr class='entry' id='log_'"+c.data[d].id+"''>";
$.each(c.data[d],function(e,f){"id"!=e&&(a="Details"==e?a+("<td style='display:none;'>"+$(f).text().toLowerCase()+"</td>"):a+("<td>"+f+"</td>"))});a+="<td>";a+="<button onClick='javascript:$.open_details(\""+escape(encodeURIComponent(c.data[d].Details))+"\")'>Details</button>";a+="</td>";a+="</tr>"});a+="</tbody></table></div>";$("#results_log").html(a)});b.fail(function(c,a){console.log("Request failed: "+a)})}else $.open_password()};
$.open_details=function(b){b=decodeURIComponent(unescape(b));b=new BootstrapDialog({message:"<div><div>"+b+'</div><div id="pw_messagebar"></div></div>',title:"Details",closable:!0,buttons:[{icon:"glyphicon glyphicon-menu-up",label:" "+configlang.CANCEL,action:function(c){c.close()}}]});b.realize();b.getModalHeader().addClass("preview-header");b.setData("name","details");b.open()};
$.search_log=function(){$("tr.entry").removeClass("collapse");$("tr.entry:not(:contains("+$("#searchlogtext").val().toLowerCase()+"))").addClass("collapse")};
$(function(){$(".lang li a").click(function(){$.set_language($(this).data("value"),!1)});$(".chart li a").click(function(){$.set_chart($(this).data("value"))});$.set_params();$(".well").find(":checkbox").click(function(){$.set_params();$.refresh()});$(".number-spinner a").click(function(){var b=$(this),c=b.closest(".number-spinner").find("input"),a=$("#year").val(),d=c.val().trim();"up"==b.attr("data-dir")?d<parseInt(moment().format("YYYY"))&&(d++,a++):d>c.attr("min")&&(d--,a--);$("#year").val(a);
c.val(d);params.year=a;$.refresh()});$("#daterange").daterangepicker({showISOWeekNumbers:!0,autoApply:!0,dateLimit:{months:6},ranges:{Heute:[moment().format("DD.MM.YYYY"),moment().format("DD.MM.YYYY")],Gestern:[moment().subtract(1,"days").format("DD.MM.YYYY"),moment().subtract(1,"days").format("DD.MM.YYYY")],"Letzten 7 Tage":[moment().subtract(8,"days").format("DD.MM.YYYY"),moment().subtract(1,"days").format("DD.MM.YYYY")],"Letzten 30 Tage":[moment().subtract(31,"days").format("DD.MM.YYYY"),moment().subtract(1,
"days").format("DD.MM.YYYY")],"Letzten 60 Tage":[moment().subtract(61,"days").format("DD.MM.YYYY"),moment().subtract(1,"days").format("DD.MM.YYYY")],"Letzten 90 Tage":[moment().subtract(91,"days").format("DD.MM.YYYY"),moment().subtract(1,"days").format("DD.MM.YYYY")],"Dieser Monat":[moment().startOf("month").format("DD.MM.YYYY"),moment().subtract(1,"days").format("DD.MM.YYYY")],"Letzter Monat":[moment().startOf("month").subtract(1,"months").format("DD.MM.YYYY"),moment().startOf("month").subtract(1,
"days").format("DD.MM.YYYY")]},locale:{format:"DD.MM.YYYY",separator:" - ",applyLabel:"Fertig",cancelLabel:"Abbrechen",fromLabel:"Von",toLabel:"Bis",customRangeLabel:"Eigener Zeitraum",weekLabel:"W",daysOfWeek:"So Mo Di Mi Do Fr Sa".split(" "),monthNames:"Januar Februar M\u00e4rz April Mai Juni Juli August September Oktober November Dezember".split(" "),firstDay:1},startDate:moment().add(-8,"days").format("DD.MM.YYYY"),endDate:moment().add(-1,"days").format("DD.MM.YYYY")},function(b,c,a){params.start=
b.format("YYYY-MM-DD");params.end=c.format("YYYY-MM-DD");$.refresh()});$(".open-daterange").click(function(b){b.preventDefault();$("#daterange").click()});config.lang="ger";$.set_language(config.lang,!0);access||$.open_password()});
